var SwipeView=function(a,b){function c(a){return""===e?a:(a=a.charAt(0).toUpperCase()+a.substr(1),e+a)}var d=b.createElement("div").style,e=function(){for(var a,b="t,webkitT,MozT,msT,OT".split(","),c=0,e=b.length;e>c;c++)if(a=b[c]+"ransform",a in d)return b[c].substr(0,b[c].length-1);return!1}(),f=e?"-"+e.toLowerCase()+"-":"",g=c("transform"),h=c("transitionDuration"),i=c("perspective")in d,j=!0,k=(c("transition")in d,i?" translateZ(0)":""),l="onorientationchange"in a?"orientationchange":"resize",m=j?"touchstart":"mousedown",n=j?"touchmove":"mousemove",o=j?"touchend":"mouseup",p=j?"touchcancel":"mouseup",q=function(){if(e===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"};return a[e]}(),r=function(c,d){var g,h,i,j;this.wrapper="string"==typeof c?b.querySelector(c):c,this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:!1,loop:!0};for(g in d)this.options[g]=d[g];for(this.wrapper.style.overflow="hidden",this.wrapper.style.position="relative",this.masterPages=[],h=b.getElementById("swipeview-slider"),h.style.cssText="position:relative;top:0;height:100%;width:100%;"+f+"transition-duration:0;"+f+"transform:translateZ(0);"+f+"transition-timing-function:ease-out",this.slider=h,this.refreshSize(),g=-1;2>g;g++)h=b.getElementById("swipeview-masterpage-"+(g+1)),h.style.cssText=f+"transform:translateZ(0);position:absolute;top:0;height:100%;width:100%;left:"+100*g+"%",h.dataset||(h.dataset={}),j=-1==g?this.options.numberOfPages-1:g,h.dataset.pageIndex=j,h.dataset.upcomingPageIndex=j,this.options.loop||-1!=g||(h.style.visibility="hidden"),this.masterPages.push(h);i=this.masterPages[1].className,this.masterPages[1].className=i?i+" swipeview-active":"swipeview-active",a.addEventListener(l,this,!1),this.wrapper.addEventListener(m,this,!1),this.wrapper.addEventListener(n,this,!1),this.wrapper.addEventListener(o,this,!1),this.slider.addEventListener(q,this,!1),"O"==e&&this.slider.addEventListener(q.toLowerCase(),this,!1)};return r.prototype={currentMasterPage:1,x:0,page:0,pageIndex:0,customEvents:[],onFlip:function(a){this.wrapper.addEventListener("swipeview-flip",a,!1),this.customEvents.push(["flip",a])},onMoveOut:function(a){this.wrapper.addEventListener("swipeview-moveout",a,!1),this.customEvents.push(["moveout",a])},onMoveIn:function(a){this.wrapper.addEventListener("swipeview-movein",a,!1),this.customEvents.push(["movein",a])},onTouchStart:function(a){this.wrapper.addEventListener("swipeview-touchstart",a,!1),this.customEvents.push(["touchstart",a])},destroy:function(){for(;this.customEvents.length;)this.wrapper.removeEventListener("swipeview-"+this.customEvents[0][0],this.customEvents[0][1],!1),this.customEvents.shift();a.removeEventListener(l,this,!1),this.wrapper.removeEventListener(m,this,!1),this.wrapper.removeEventListener(n,this,!1),this.wrapper.removeEventListener(o,this,!1),this.slider.removeEventListener(q,this,!1)},refreshSize:function(){this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.pageWidth=this.wrapperWidth,this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth,this.snapThreshold=null===this.options.snapThreshold?Math.round(.15*this.pageWidth):/%/.test(this.options.snapThreshold)?Math.round(this.pageWidth*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},updatePageCount:function(a){this.options.numberOfPages=a,this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth},goToPage:function(a){var b;for(this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,""),b=0;3>b;b++)className=this.masterPages[b].className,/(^|\s)swipeview-loading(\s|$)/.test(className)||(this.masterPages[b].className=className?className+" swipeview-loading":"swipeview-loading");a=0>a?0:a>this.options.numberOfPages-1?this.options.numberOfPages-1:a,this.page=a,this.pageIndex=a,this.slider.style[h]="0s",this.__pos(-a*this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className+" swipeview-active",0===this.currentMasterPage?(this.masterPages[2].style.left=100*this.page-100+"%",this.masterPages[0].style.left=100*this.page+"%",this.masterPages[1].style.left=100*this.page+100+"%",this.masterPages[2].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[0].dataset.upcomingPageIndex=this.page,this.masterPages[1].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1):1==this.currentMasterPage?(this.masterPages[0].style.left=100*this.page-100+"%",this.masterPages[1].style.left=100*this.page+"%",this.masterPages[2].style.left=100*this.page+100+"%",this.masterPages[0].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[1].dataset.upcomingPageIndex=this.page,this.masterPages[2].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1):(this.masterPages[1].style.left=100*this.page-100+"%",this.masterPages[2].style.left=100*this.page+"%",this.masterPages[0].style.left=100*this.page+100+"%",this.masterPages[1].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[2].dataset.upcomingPageIndex=this.page,this.masterPages[0].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1),this.__flip()},next:function(){(this.options.loop||this.x!=this.maxX)&&(this.directionX=-1,this.x-=1,this.__checkPosition())},prev:function(){(this.options.loop||0!==this.x)&&(this.directionX=1,this.x+=1,this.__checkPosition())},handleEvent:function(a){switch(a.type){case m:this.__start(a);break;case n:this.__move(a);break;case p:case o:this.__end(a);break;case l:this.__resize();break;case q:case"otransitionend":a.target!=this.slider||this.options.hastyPageFlip||this.__flip()}},__pos:function(a){this.x=a,this.slider.style[g]="translate("+a+"px,0)"+k},__resize:function(){this.refreshSize(),this.slider.style[h]="0s",this.__pos(-this.page*this.pageWidth)},__start:function(a){if(!this.initiated){var b=j?a.touches[0]:a;this.initiated=!0,this.moved=!1,this.thresholdExceeded=!1,this.startX=b.pageX,this.startY=b.pageY,this.pointX=b.pageX,this.pointY=b.pageY,this.stepsX=0,this.stepsY=0,this.directionX=0,this.directionLocked=!1,this.slider.style[h]="0s",this.__event("touchstart")}},__move:function(a){if(this.initiated){var b=j?a.touches[0]:a,c=b.pageX-this.pointX,d=b.pageY-this.pointY,e=this.x+c,f=Math.abs(b.pageX-this.startX);if(this.moved=!0,this.pointX=b.pageX,this.pointY=b.pageY,this.directionX=c>0?1:0>c?-1:0,this.stepsX+=Math.abs(c),this.stepsY+=Math.abs(d),!(this.stepsX<10&&this.stepsY<10)){if(!this.directionLocked&&this.stepsY>this.stepsX)return void(this.initiated=!1);a.preventDefault(),this.directionLocked=!0,!this.options.loop&&(e>0||e<this.maxX)&&(e=this.x+c/2),!this.thresholdExceeded&&f>=this.snapThreshold?(this.thresholdExceeded=!0,this.__event("moveout")):this.thresholdExceeded&&f<this.snapThreshold&&(this.thresholdExceeded=!1,this.__event("movein")),this.__pos(e)}}},__end:function(a){if(this.initiated){var b=j?a.changedTouches[0]:a,c=b.pageX-this.startX;if(this.initiated=!1,this.moved)return!this.options.loop&&(this.x>0||this.x<this.maxX)&&(c=0,this.__event("movein")),Math.abs(c)<this.snapThreshold?(this.slider.style.webkitTransitionDuration=Math.floor(300*Math.abs(c)/this.snapThreshold)+"ms",void this.__pos(-this.page*this.pageWidth)):0>c&&this.directionX>=0||c>0&&this.directionX<=0?(this.slider.style.webkitTransitionDuration=Math.floor(300*Math.abs(c)/this.pageWidth)+"ms",void this.__pos(-this.page*this.pageWidth)):void this.__checkPosition()}},__checkPosition:function(){var a,b,c;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,""),this.directionX>0?(this.page=-Math.ceil(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=0===this.pageIndex?this.options.numberOfPages-1:this.pageIndex-1,a=this.currentMasterPage-1,a=0>a?2:a,this.masterPages[a].style.left=100*this.page-100+"%",b=this.page-1):(this.page=-Math.floor(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=this.pageIndex==this.options.numberOfPages-1?0:this.pageIndex+1,a=this.currentMasterPage+1,a=a>2?0:a,this.masterPages[a].style.left=100*this.page+100+"%",b=this.page+1),c=this.masterPages[this.currentMasterPage].className,/(^|\s)swipeview-active(\s|$)/.test(c)||(this.masterPages[this.currentMasterPage].className=c?c+" swipeview-active":"swipeview-active"),c=this.masterPages[a].className,/(^|\s)swipeview-loading(\s|$)/.test(c)||(this.masterPages[a].className=c?c+" swipeview-loading":"swipeview-loading"),b-=Math.floor(b/this.options.numberOfPages)*this.options.numberOfPages,this.masterPages[a].dataset.upcomingPageIndex=b,newX=-this.page*this.pageWidth,this.slider.style[h]=Math.floor(500*Math.abs(this.x-newX)/this.pageWidth)+"ms",this.options.loop||(this.masterPages[a].style.visibility=0===newX||newX==this.maxX?"hidden":""),this.x==newX?this.__flip():(this.__pos(newX),this.options.hastyPageFlip&&this.__flip())},__flip:function(){this.__event("flip");for(var a=0;3>a;a++)this.masterPages[a].className=this.masterPages[a].className.replace(/(^|\s)swipeview-loading(\s|$)/,""),this.masterPages[a].dataset.pageIndex=this.masterPages[a].dataset.upcomingPageIndex},__event:function(a){var c=b.createEvent("Event");c.initEvent("swipeview-"+a,!0,!0),this.wrapper.dispatchEvent(c)}},r}(window,document);!function(a,b,c){a.fn.responsiveSwipe=function(d){var e,f,g,h,i,j,k,l,m=function(){},n=a.extend({afterLoad:m,beforeShow:m,afterShow:m,ajaxRegex:".*",breakpoints:[640,1024,1440,1920],edition:[],enablePjax:!0,enableSwipe:!0,emulator:!1,expiryPeriod:0,linkSelector:"a:not(.no-ajax)",pageDataSelector:".responsive-swipe-meta",queryParam:"frag_width",loadingIndicator:void 0,swipeViewLib:"/js/responsive-swipe_swipeview.js",widthGuess:1440},d),o=new RegExp(n.ajaxRegex,"g"),p={},q=a("link[rel=canonical]"),r="initial",s=a(this)[0],t=a(this).offset().top,u=-1,v=[],w=0,x=!1,y=!1,z=!1,A=0,B=0,C=a(this).find("#swipeview-slider > #swipeview-masterpage-1")[0],D=1,E=1,F=0,G=0,H=c.referrer;if(n.enablePjax&&b.history&&history.pushState&&(x=!0,e=b.navigator.userAgent.match(/Android\s+([\d\.]+)/i),e&&parseFloat(e[1])<=4.1&&(x=!!b.navigator.userAgent.match(/(Chrome|Firefox)/i))),n.enableSwipe)for(var I=["ms","Khtml","O","Moz","Webkit",""];I.length;)if(I.pop()+"Transition"in c.body.style){y=!0;break}var J=function(){try{var b=a(C).find(n.pageDataSelector).eq(0).data("pagedata");return b&&"object"==typeof b?b:{}}catch(c){return{}}};"function"!=typeof Number.prototype.mod&&(Number.prototype.mod=function(a){return(this%a+a)%a});var K=function(){var a={};return function(b,c,d){d=d||1,clearTimeout(a[d]),a[d]=setTimeout(b,c)}}(),L=function(a){var b=c.createElement("a");return b.href=a,b=b.pathname+b.search,b=0===b.indexOf("/")?b:"/"+b},M=function(){if(n.emulator)M=function(){return a(b).width()};else{var c=screen.width;M=function(){return c}}return M()},N=function(){var a,b,c,d=n.breakpoints,e=n.breakpoints.length;return(N=function(){for(c=M(),a=e-1;a>=0;a--)if(b=d[a],c>=b)return b;return 0})()},O=function(b){var c,d,e=b.url,f=b.container,g=b.callback||m,h={};e&&f&&(f.dataset=f.dataset||{},f.dataset.url=e,c=p[e],c?(P(f,c,"from-cache"),f.dataset.loadTime=0,g()):(h[n.queryParam]=N(),d=(new Date).getTime(),f.dataset.waiting="1",a.ajax({url:e,dataType:"html",data:h,type:"GET",success:function(a){a.match(o)?f.dataset.url===e&&(P(f,a,null),p[e]=a,g()):(a='<div class="responsive-swipe-error">Oops. That went wrong. <a class="no-ajax" href="'+e+'">Try again.</a></div>',P(f,a,"ajax-error"),console&&(console.log("WARNING! Ajax response didn't validate against regex: "+n.ajaxRegex),console.log("WARNING! Enable XMLHttpRequest logging in your browser, then check the responses."))),f.dataset.waiting="",d=(new Date).getTime()-d,f.dataset.loadTime=d,A+=d,B+=1,B>50&&(B=0,A=0,p={})},error:function(){}}),b.showSpinner&&U.show()))},P=function(b,c,d){var e=a(b);e.html(c);var f=e.find(".pageBodyInner");f.removeClass("ajax-loaded from-cache"),f.addClass(null!=d?"ajax-loaded "+d:"ajax-loaded"),U.hide(),n.afterLoad(b)},Q=function(a){O({url:L(b.location.href),container:C,callback:a})},R=function(){n.afterLoad(C)};a(b).resize(function(){n.emulator?K(function(){p={},Q()},1013,"reloadContent"):R()});var S=function(){var b=a(C).children().height();b&&a(s).height(b+F+30)},T=function(){var d,e,g;if(S(),f=!1,h?(x&&(p[h]=a(C).html()),d=i,h=i=void 0):(d=C.dataset.url,H=b.location.href),k=J(),k.title&&(e=c.createElement("div"),e.innerHTML=k.title,c.title=e.firstChild.nodeValue),!j){var l={id:_.nxt(),editionPos:u};cb(l,c.title,d)}j=!1,q.attr("href",b.location.href),k.clickType=r,k.referrer=H,C.dataset&&C.dataset.loadTime&&(k.loadTime=Math.round(C.dataset.loadTime)/1e3,k.loadTimeAverage=Math.round(A/B)/1e3),n.afterShow(C,k,eb),g=V(L(d)),g>-1?(z=!0,u=g):z=!1,gb()},U=function(){var b=a(n.loadingIndicator),c={};return b.length?(c.show=function(){b.show()},c.hide=function(){b.hide()}):c.show=c.hide=m,c}(),V=function(b){return a.inArray(L(b),v)},W=function(a){return a>-1&&w>a?v[a]:v[0]},X=function(b){var c;a.isArray(b)&&b.length>=3&&(c=fb(b.toString()),g!==c&&(v=b,w=b.length,u=-1,z=!1,g=c))},Y=function(a){b.location.href=a},Z=function(a){return 0===a?W(u):k.nextUrl&&1===a?k.nextUrl:k.prevUrl&&-1===a?k.prevUrl:W(u>-1&&z?(u+a).mod(w):u>-1&&!z?(u+(1===a?1:0)).mod(w):1===a?1:0)},$=function(a){f||(f=!0,db(),Y(Z(a)))};a(c).keydown(function(a){switch(r="keyboard_arrow",a.keyCode){case 37:$(-1);break;case 39:$(1)}});var _=function(){var a=0;return{set:function(b){a=b},nxt:function(){return a+=1},get:function(){return a}}}(),ab=function(a){var b=a.currentTarget;if(!(a.which>1||a.metaKey||a.ctrlKey||location.protocol!==b.protocol||location.host!==b.host||b.hash&&b.href.replace(b.hash,"")===location.href.replace(location.hash,"")))return!0},bb=function(a){var b;a!==u&&w>a&&(db(),b=u>a?-1:1,u=a,Y(W(a),b))},cb=function(){return x&&b.history?function(a,c,d){b.history.pushState(a,c,d)}:m}(),db=function(){n.beforeShow()},eb={setEdition:X,gotoEditionPage:function(a,b){r=b?b.toString():"position",bb(a,b)},gotoUrl:function(a,b){r=b?b.toString():"link",Y(a)},gotoNext:function(a){r=a?a.toString():"screen_arrow",$(1)},gotoPrev:function(a){r=a?a.toString():"screen_arrow",$(-1)}},fb=function(a){var b,c=305419896;for(b=0;b<a.length;b++)c+=a.charCodeAt(b)*b;return c},gb=function(){gb=m,x&&(Y=function(a){db(),O({url:a,container:C,showSpinner:!0,callback:function(){T()}})},b.onpopstate=function(a){var c,d,e=a.state;e&&(r="browser_history",c=e.id?e.id:-1,d=c<_.get()?-1:1,_.set(c),j=!0,u=e.editionPos,Y(L(b.location.href),d))},a(c).on("click",n.linkSelector,function(c){var d;return ab(c)?(c.preventDefault(),d=L(a(this).attr("href")),void(d===L(b.location.href)?b.location.reload(!0):(r="link",Y(d)))):!0}),!y||3>w||("SwipeView"in b?hb():a.ajax({url:n.swipeViewLib,type:"GET",dataType:"script",cache:!0,complete:function(){"SwipeView"in b?hb():console&&console.log("WARNING! Couldn't load "+n.swipeViewLib)}})))},hb=function(){Y=function(a,c){var d=V(a);db(),L(b.location.pathname)===a?c=0:"undefined"==typeof c&&(c=d>-1&&u>d?-1:1),e({url:a,dir:c,slideIn:!0})},Q=function(){c(0),c(1),c(-1)},R=function(){d(0),d(1),d(-1)};var c=function(a){var b=l.masterPages[(D+a).mod(3)];O({url:b.dataset.url,container:b})},d=function(a){var b=l.masterPages[(D+a).mod(3)];n.afterLoad(b)},e=function(b){var c,d=b.dir||0,e=b.url,f=!!b.slideIn;e||(e=Z(d)),e=L(e),c=l.masterPages[(D+d).mod(3)],c.dataset.url!==e||a.isEmptyObject(p)?(c.innerHTML="",O({url:e,container:c,showSpinner:f,callback:function(){c===C?T():f&&c.dataset.url===e&&g(d)}})):f&&g(d)},g=function(a){switch(db(),a){case 1:l.next();break;case-1:l.prev();break;default:T()}},h=function(){e({dir:1}),e({dir:-1})};$=function(a){f||(f=!0,g(a))},a(b).scroll(function(){G=Math.max(0,a(b).scrollTop()-t),F>G?(a(l.masterPages).css("marginTop",0),a(b).scrollTop(t),F=0,G=0):a(l.masterPages).not(":eq("+D+")").css("marginTop",G)}),l=new SwipeView(s,{}),l.onFlip(function(){D=(l.pageIndex+1).mod(3),E!==D&&(a(l.masterPages[E]).css("marginTop",G),F=G,E=D,C=l.masterPages[D],C.dataset&&"1"===C.dataset.waiting&&U.show(),T())}),l.onMoveOut(function(){db(),r="swipe"}),C=l.masterPages[1],C.dataset.url=L(b.location.href),h(),gb=h,a("body").addClass("has-swipe")};return n.afterLoad(C),i=b.location.href,h=L(i),X(n.edition),n.emulator?Q(T):n.widthGuess?T():N()>n.breakpoints[0]?Q(T):T(),n.expiryPeriod&&setInterval(function(){p={}},parseInt(n.expiryPeriod,10)),setInterval(function(){S()},509),eb}}(jQuery,window,document);